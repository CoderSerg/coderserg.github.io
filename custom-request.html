<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Request · Serhii</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: "#10b981" },
        }
      }
    };
  </script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@latest/dist/umd/supabase.js"></script>

</head>

<body class="bg-gray-950 text-white min-h-screen flex items-center justify-center px-6">

  <main class="w-full max-w-xl">

    <!-- Back -->
    <a href="./index.html"
       class="text-gray-400 hover:text-white text-sm mb-6 inline-block">
      ← Back
    </a>

    <!-- HEADER -->
    <h1 class="text-4xl font-bold mb-2">
      Custom <span class="text-brand">Request</span>
    </h1>
    <p class="text-gray-400 mb-8">
      Want a custom 3D print? Send your request below.
    </p>

    <!-- CARD -->
    <div class="bg-white/5 border border-white/10 backdrop-blur-xl p-8 rounded-2xl space-y-6">

      <!-- TITLE -->
      <div>
        <label class="text-sm text-gray-300">Title</label>
        <input id="req-title"
               class="w-full mt-1 p-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-brand"
               placeholder="Example: Custom Dragon Model" />
      </div>

      <!-- DESCRIPTION -->
      <div>
        <label class="text-sm text-gray-300">Description</label>
        <textarea id="req-desc"
                  class="w-full mt-1 p-3 h-32 bg-white/5 border border-white/10 rounded-xl resize-none focus:outline-none focus:border-brand"
                  placeholder="Describe what you want…"></textarea>
      </div>

      <!-- SUBMIT -->
      <button onclick="submitRequest()"
              class="w-full py-3 bg-brand text-black rounded-xl font-semibold hover:bg-brand/80 transition">
        Submit Request →
      </button>

      <!-- STATUS MESSAGE -->
      <p id="req-status" class="text-center text-sm mt-3 text-gray-400"></p>

    </div>

  </main>


  <script>
    const SUPABASE_URL = "https://ixrcmespfkbvubxsaqvf.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4cmNtZXNwZmtidnVieHNhcXZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1ODc3MDgsImV4cCI6MjA3OTE2MzcwOH0.OONsZEtb-VUAsBgTICYixl8M-GU4dMT6FK-Gg3s3i94";

    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function submitRequest() {
      const title = document.getElementById("req-title").value.trim();
      const desc = document.getElementById("req-desc").value.trim();
      const statusEl = document.getElementById("req-status");

      if (!title || !desc) {
        statusEl.textContent = "Please enter both title and description.";
        statusEl.classList.add("text-red-400");
        return;
      }

      statusEl.textContent = "Submitting…";
      statusEl.classList.remove("text-red-400");
      statusEl.classList.add("text-gray-400");

      // GET USER
      const { data: auth } = await _supabase.auth.getUser();
      const user = auth.user;

      if (!user) {
        statusEl.textContent = "You must be logged in to send a request.";
        statusEl.classList.add("text-red-400");
        return;
      }

      // SEND TO EDGE FUNCTION
      try {
        const res = await fetch(
          "https://ixrcmespfkbvubxsaqvf.supabase.co/functions/v1/get-requests",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${_supabase.auth.session?.access_token || ""}`,
            },
            body: JSON.stringify({
              user_id: user.id,
              title: title,
              description: desc,
            }),
          }
        );

        if (!res.ok) throw new Error("Request failed.");

        statusEl.textContent = "Request sent successfully!";
        statusEl.classList.add("text-brand");

        document.getElementById("req-title").value = "";
        document.getElementById("req-desc").value = "";

      } catch (err) {
        statusEl.textContent = "Error sending request. Check CORS or server log.";
        statusEl.classList.add("text-red-400");
        console.error(err);
      }
    }
  </script>

</body>
</html>
