<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard · Serhii</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: "#10b981" }
        }
      }
    };
  </script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-gray-950 text-white min-h-screen">

  <!-- WRAPPER -->
  <main class="max-w-5xl mx-auto px-6 py-14">

    <!-- HEADER -->
    <div class="flex justify-between items-center mb-10">
      <h1 class="text-3xl font-bold">Admin Dashboard</h1>

      <a href="./index.html"
         class="px-4 py-2 bg-white/10 rounded-lg border border-white/10
                hover:bg-white/20 transition">
        ← Back
      </a>
    </div>

    <!-- REQUESTS LIST -->
    <div id="requestsBox" class="space-y-6">
      <p class="text-gray-400">Loading requests…</p>
    </div>

  </main>

  <script>
    /* === CONFIG === */
    const SUPABASE_URL = "https://ixrcmespfkbvubxsaqvf.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4cmNtZXNwZmtidnVieHNhcXZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1ODc3MDgsImV4cCI6MjA3OTE2MzcwOH0.OONsZEtb-VUAsBgTICYixl8M-GU4dMT6FK-Gg3s3i94";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const ADMIN_UUID = "7b2183d3-96e9-4edd-8cca-d6166a24b12b";


    /* === REDIRECT IF NOT ADMIN === */
    async function checkAdmin() {
      const { data } = await supabaseClient.auth.getUser();
      const user = data.user;

      if (!user) {
        window.location.href = "./index.html";
        return;
      }

      if (user.id !== ADMIN_UUID) {
        window.location.href = "./index.html";
        return;
      }

      loadRequests();
    }


    /* === LOAD REQUESTS FROM EDGE FUNCTION === */
    async function loadRequests() {
      const box = document.getElementById("requestsBox");

      try {
        const res = await fetch(
          "https://ixrcmespfkbvubxsaqvf.supabase.co/functions/v1/get-requests"
        );

        if (!res.ok) {
          box.innerHTML = `<p class="text-red-400">Failed to load requests.</p>`;
          return;
        }

        const data = await res.json();

        if (!data.length) {
          box.innerHTML = `<p class="text-gray-400">No custom requests yet.</p>`;
          return;
        }

        box.innerHTML = "";
        data.forEach(r => box.appendChild(makeRequestCard(r)));

      } catch (err) {
        box.innerHTML = `<p class="text-red-400">Error loading requests.</p>`;
      }
    }


    /* === REQUEST CARD UI === */
    function makeRequestCard(req) {
      const div = document.createElement("div");
      div.className =
        "bg-white/5 p-6 rounded-2xl border border-white/10 shadow-xl space-y-4";

      div.innerHTML = `
        <h3 class="text-lg font-semibold text-white">Custom Request</h3>

        <p class="text-gray-400 text-sm">
          <span class="font-medium text-white">Name:</span> ${req.full_name || "Unknown"}
        </p>

        <p class="text-gray-400 text-sm">
          <span class="font-medium text-white">Email:</span> ${req.email}
        </p>

        <p class="text-gray-300 text-sm whitespace-pre-wrap">
          ${req.request_text}
        </p>

        <div class="flex gap-3 pt-4">
          <button
            onclick="approveRequest('${req.id}')"
            class="px-4 py-2 bg-brand text-black rounded-lg font-semibold hover:bg-brand/80 transition">
            Approve
          </button>

          <button
            onclick="rejectRequest('${req.id}')"
            class="px-4 py-2 bg-red-600 rounded-lg font-semibold hover:bg-red-500 transition">
            Reject
          </button>
        </div>
      `;

      return div;
    }


    /* === EDGE FUNCTION CALL TEMPLATES === */
    async function approveRequest(id) {
      alert("Approve function not implemented yet (needs edge function). ID: " + id);
    }

    async function rejectRequest(id) {
      alert("Reject function not implemented yet (needs edge function). ID: " + id);
    }

    /* START */
    checkAdmin();
  </script>

</body>
</html>
